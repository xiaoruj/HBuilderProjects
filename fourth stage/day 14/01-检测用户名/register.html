<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户注册</title>
    <link crossorigin="anonymous" href="https://cdn.bootcss.com/twitter-bootstrap/3.3.7/css/bootstrap.min.css"
          rel="stylesheet">
    <script crossorigin="anonymous" src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
</head>
<body>
<div class="container">
    <div class="col-xs-4 col-xs-offset-4">
        <h2 class="page-header">用户注册</h2>
        <form method="post" action="/register">
            <div class="form-group">
                <label class="control-label" for="exampleInputEmail1">用户名</label>
                <input type="text" name="username" class="form-control" id="exampleInputEmail1" placeholder="">
                <span class="help-block"></span>
            </div>
            <div class="form-group">
                <label class="control-label" for="exampleInputPassword1">密码</label>
                <input type="password" name="password" class="form-control" id="exampleInputPassword1" placeholder="">
                <span class="help-block"></span>
            </div>
            <hr>
            <button type="submit" class="btn btn-block btn-success">注册</button>
        </form>
    </div>

    <script>
        let Flag_username = false;
        let Flag_password = false;
        $('input[name=username]').blur(function () {
            let username = this.value;// $(this).val();
            let reg = /^\w{8,20}$/;// 45645611 a%^&*()_
            if (!reg.test(username)) {
                $(this).parent().addClass('has-error');
                $(this).next().html('用户名格式错误');
                Flag_username = false;
                return;
            }
            $(this).parent().removeClass('has-error').addClass('has-success');
            $(this).next().html('');
            let that = $(this);
            $.post('/check-username', {username: username}, function (data) {
                if (data === '0') {
                    that.parent().removeClass('has-success').addClass('has-error');
                    that.next().html('此用户名太受欢迎!');
                    Flag_username = false;
                }

                if (data === '1') {
                    that.parent().removeClass('has-error').addClass('has-success');
                    that.next().html('');
                    Flag_username = true;
                }
            });
        })

        $('input[name=password]').blur(function () {
            let password = $(this).val();
            let regLength = /^\S{6,20}$/;
            let regUpperCase = /[A-Z]/;
            let regSymbol = /[\!\@\#\$\%\^\&\*\(\)\{\}\[\]]/;
            let level = 0;
            if (!regLength.test(password)) {
                $(this).parent().addClass('has-error');
                $(this).next().html('密码格式为 6-20 非空白字符');
                Flag_password = false;
                return;
            }
            if (!regUpperCase.test(password)) {
                $(this).parent().addClass('has-error');
                $(this).next().html('密码必须包含大写字母');
                Flag_password = false;
                return;
            }
            if (!regSymbol.test(password)) {
                $(this).parent().addClass('has-error');
                $(this).next().html('密码必须包含特殊符号');
                Flag_password = false;
                return;
            }
            Flag_password = true;
            $(this).parent().removeClass('has-error').addClass('has-success');
            $(this).next().html('');
        });
        $('form').submit(function () {
            $('input[name=username]').trigger('blur');
            $('input[name=password]').trigger('blur');

            if(Flag_username && Flag_password){
                return true;
            }
            return false;
        });
    </script>
</div>
</body>
</html>