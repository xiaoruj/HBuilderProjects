<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.bootcss.com/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script crossorigin="anonymous" src="https://cdn.bootcss.com/axios/0.19.2/axios.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>

</head>
<body>
<div class="container col-xs-6 col-xs-offset-3">
    <h2 class="page-header">文章管理</h2>

    <table class="table table-bordered table-striped table-hover">
        <thead>
        <tr>
            <th>ID</th>
            <th>标题</th>
            <th>作者</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>

        </tbody>
    </table>

    <hr>

    <h2 class="page-header">添加文章</h2>
    <form>
        <div class="form-group">
            <label for="exampleInputEmail1">文章标题</label>
            <input type="text" name="title" class="form-control" id="exampleInputEmail1" placeholder="">
        </div>
        <div class="form-group">
            <label for="exampleInputPassword1">作者</label>
            <input type="text" name="author" class="form-control" id="exampleInputPassword1" placeholder="">
        </div>

        <button type="button" class="btn btn-default btn-block" onclick="addArticle()">添加文章</button>
    </form>
</div>
<script>
    function init() {
        axios.get('http://127.0.0.1:3000/articles').then(response => {
            console.log(response.data);
            for(let i = 0; i < response.data.length; i++){
                $(`<tr>
                    <td>${response.data[i].id}</td>
                        <td ondblclick="updateArticle(this)">${response.data[i].title}</td>
                        <td>${response.data[i].author}</td>
                        <td>
                            <button aid="${response.data[i].id}" onclick="deleteArticle(this)" class="btn btn-xs btn-danger">删除</button>
                        </td>
                    </tr>`).appendTo('tbody');
            }
        });
    }
    init();
    function addArticle() {
        let title = $('input[name=title]').val();
        let author = $('input[name=author]').val();
        axios.post('http://localhost:3000/articles', {title, author}).then(response => {
            $(`<tr><td>${response.data.id}</td><td>${response.data.title}</td><td>${response.data.author}</td><td><button aid="${response.data.id}" onclick="deleteArticle(this)" class="btn btn-xs btn-danger">删除</button></td></tr>`).appendTo('tbody');
        });
    }

    function daleteArticle(ele) {
        let id = $(ele).attr('aid');
        axios.delete('http://127.0.0.1:3000/articles/'+id).then(response => {
            if(Object.keys(response.data).length === 0){
                $(ele).parents('tr').remove();
            }
        });
    }
    function updateArticle(ele) {
        let id = $(ele).parent().find('td:first').html();
        let title = $(ele).html();
        let input = $('<input />');
        ele.innerHTML = '';
        $(ele).append(input);
        input.val(title);
        input.blur(function () {
            let v = input.val();
            axios.patch('http://localhost:3000/articles/'+id, {title: v}).then(response => {
                $(ele).html(response.data.title);
            });
        });
    }
    

    function sendGET() {
        axios.get('http://localhost:3000/articles').then(response=>{
            console.log(response.data);
        });
    }
    //post
    function sendPOST() {
        axios.post('http://localhost:3000/articles', {title:'今日新闻-1', author:'测试'}).then(response=>{
            console.log(response.data);
        });
    }

    //put
    function sendPUT() {
        axios.put('http://localhost:3000/articles/4', {title:'今日新闻-2', author:'xiaoru'}).then(response=>{
            console.log(response.data);
        });
    }
    function sendPatch() {
        axios.patch('http://localhost:3000/articles/4', {title:'攒够了失望就离开吧'}).then(response=>{
            console.log(response.data);
        });
    }
    //delete
    function sendDELETE() {
        axios.delete('http://localhost:3000/articles/4').then(response=>{
            console.log(response.data);
        });
    }
</script>
</body>
</html>