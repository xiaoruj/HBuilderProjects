<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.bootcss.com/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
    <button onclick="send()" class="btn btn-primary">发送</button>
    <button onclick="cancel()" class="btn btn-danger">取消</button>

    <script>
        function axios({url, method = 'GET', cancelToken}) {
        return new Promise((resolve, reject) => {
            let x = new XMLHttpRequest();
            x.onreadystatechange = function () {
                if (x.readyState === 4) {
                    if (x.status >= 200 && x.status < 300) {
                        resolve(x.responseText);
                    } else {
                        reject('请求失败, 状态码为:' + x.status);
                    }
                }
            }
            x.open(method, url);
            x.send();
            if (cancelToken) {
                cancelToken.promise.then(value => {
                    x.abort();
                    reject(value);
                });
            }
        })
    }
    axios.CancelToken = CancelToken;

    function CancelToken(excutor) {
        let resolveFn;
        this.promise = new Promise((resolve) => {
            resolveFn = resolve;
        });
        excutor(function (message) {
            resolveFn(message);
        });
    }
    var quxiao = null;
    function send() {
        axios({
            url: 'http://localhost:8000/delay-server',
            cancelToken: new axios.CancelToken(function (c) {
                quxiao = c;
            })
        }).then(response => {
            console.log(response);
        }, error => {
            console.log(error);
        });
    }
    function cancel(){
        quxiao();
    }
    </script>
</body>
</html>