# 组件通信

## props 父子组件间通信的基本方式

## props 通过标签属性方式传递数据

- 特点：props 是父组件传递数据给子组件，子组件只能读取使用，不应该直接修改
- 父组件定义 data 数据 `{comments: [{}, {}]}`
- 父组件给子组件指定标签属性：`<CommentList :comments="comments" />`
- 子组件声明接受标签属性（声明接受之后，子组件实例对象就直接拥有这个属性）
- 数据定义在哪个组件
  - 如果数据只有一个组件使用，就定义在这个组件内容
  - 如果数据由多个组件使用，就定义在多个组件的公共父组件中
- 更新数据的方法定义在哪个组件？
  - 数据源在哪里，更新数据方法就定义在哪

## 自定义事件

1. 原生 DOM 事件

- 绑定事件监听

  - 事件名称(事件名是固定，有限的 n 个事件名)
  - 事件回调函数

- 触发事件/分发事件
  - 当用户做了某些操作（点击按钮，移动鼠标...），浏览器会自动触发事件
  - 数据：event 对象

2. Vue 的自定义事件

- 绑定事件监听

  - 事件名称(事件名是任意的。通常不会和原生 DOM 事件一致)
  - 事件回调函数

# 给 Child 组件绑定自定义事件：

    事件名：add-person，事件名一般没有大写
    事件回调函数：addPerson

# ref 获取 DOM 元素或组件实例对象

    如果ref设置到普通html元素上，得到就是这个DOM元素
    如果ref设置到组件上，得到就是组件实例对象

- 触发事件/分发事件

  - 手动触发：`this.$emit(事件名称[, 事件参数1, 事件参数2...])`
    - `this.$emit(eventName[, arg1, arg2...])`
    - []代表可选值（可传可不传）
  - 数据：arg1, arg2...

- 注意：绑定自定义事件的组件对象 A，那么触发事件组件对象也必须是 A，其他组件不能触发（哪个组件绑定事件，只有这个组件可以触发，其他组件触发不了）
- 作用：用于子组件向父组件通信

# 全局事件总线 Event Bus

- 原理：基于自定义事件，解决自定义事件痛点
- 自定义事件痛点：哪个组件绑定事件，只有这个组件可以触发，其他组件触发不了
  - 导致结果只能实现子组件向父组件通信
- 目的：实现所有组件任意通信
- 解决：给任意组件绑定事件，能由任意组件触发事件

- 全局事件总线 / 全局事件对象
  - `$globalEventBus` 用来统一绑定事件或者触发事件的对象
- 作用：可以用来实现任意组件通信
  - 通常用于：兄弟/祖孙 （一般父子组件用 props 最方便）

# 消息发布机制

1. 发布消息 PubSub.publish(msg, data);发布消息可以多次
2. 订阅消息 PubSub.subscribe(msg, callback);订阅消息只要做一次，通常在 created 中完成
3. 取消订阅消息 PubSub.unsubscribe(msg);

# 插槽

    作用：父组件向子组件传递标签数据
    父组件有父组件作用域，只能读取使用当前作用域数据
    子组件有子组件作用域，只能读取使用当前作用域数据
    父组件通常情况下是不能读取子组件数据使用的。

- slot
  父组件向子组件通信，通信是带数据的标签
  注意: 标签是在父组件中解析
- 父组件定义标签数据

  ```vue
  <Child>
    <template>xxx</template>
  </Child>
  ```

- 子组件接受使用

  ```vue
  <slot></slot>
  ```

- 问题：多个标签只能渲染到一个位置，不能选择多个渲染位置
- 适用于只有一个标签数据

- 具名/命名插槽

  - 父组件定义标签数据

  ```vue
  <Child>
    <template v-slot:title>xxx</template>
    <template #title>xxx</template>
  </Child>
  ```

  - 子组件接受使用

  ```vue
  <slot name="title"></slot>
  ```

- 问题：不能获取子组件数据渲染
- 适用于有多个标签数据

- 作用域插槽

  - 父组件声明接受数据

  ```vue
  <Child>
    <template #title="data">{{data.perons}}</template>
    <template #title="{ persons }">{{persons}}</template>
  </Child>
  ```

  - 子组件传递数据

  ```vue
  <slot name="title" :persons="person"></slot>
  ```

- 适用于有多个标签数据，并且要接受子组件数据渲染
- 插槽内容是在父组件中编译后, 再传递给子组件

1. 在 html 标签上只能绑定原生事件监听
   event 是浏览器分发事件时传递过来的数据对象
   只有加了.native 修饰符，绑定的才是原生事件监听，而且会自动绑定到组件的跟标签 内部有事件委托
2. 组件绑定的是自定义事件监听，若想绑定原生，需要加.native，而且会自动绑定到组件的根标签(内部有事件委托)
3. 分发自定义事件:
   <button @click="\$emit('xxx', {m: 1})">自定义 xxx 事件</button>
   model
   一个组件上的 v-model 默认会利用名为 value 的 prop 和名为 input 的事件，但是像单选框、复选框等类型的输入控件可能会将 value attribute 用于不同的目的
   vm-$attrs
   包含了父作用域中不作为 prop 被识别 (且获取) 的 attribute 绑定 (class 和 style 除外)。当一个组件没有声明任何 prop 时，这里会包含所有父作用域的绑定 (class 和 style 除外)，并且可以通过 v-bind="$attrs" 传入内部组件——在创建高级别的组件时非常有用
   vm-$listeners
   包含了父作用域中的 (不含 .native 修饰器的) v-on 事件监听器。它可以通过 v-on="$listeners" 传入内部组件——在创建更高层次的组件时非常有用。
   v-bind
   .prop - 作为一个 DOM property 绑定而不是作为 attribute 绑定。(差别在哪里？)
   .camel 将 kebab-case attribute 名转换为 camelCase。
   .sync 语法糖，会扩展成一个更新父组件绑定值的 v-on 侦听器。
   动态地绑定一个或多个 attribute，或一个组件 prop 到表达式。
   在绑定 class 或 style attribute 时，支持其它类型的值，如数组或对象。可以通过下面的教程链接查看详情
   v-on
   绑定事件监听器。事件类型由参数指定。表达式可以是一个方法的名字或一个内联语句，如果没有修饰符也可以省略。
   用在普通元素上时，只能监听原生 DOM 事件。用在自定义元素组件上时，也可以监听子组件触发的自定义事件。
   在监听原生 DOM 事件时，方法以事件为唯一的参数。如果使用内联语句，语句可以访问一个 $event property：v-on:click="handle('ok', $event)"。
   $children 所有直接子组件对象的数组
当前实例的直接子组件。需要注意 $children 并不保证顺序，也不是响应式的。如果你发现自己正在尝试使用 $children 来进行数据绑定，考虑使用一个数组配合 v-for 来生成子组件，并且使用 Array 作为真正的来源。
$parent 父组件
   \$refs 包含所有 ref 属性对象或组件对象的容器对象
